<!DOCTYPE html>
<html style="background: #000;">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>榮騰農產</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= stylesheet_link_tag "order_check", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>

  <script>
  $(document).ready(function() {
    $("body").css("display", "none");
    $("body").fadeIn(500);
  });
  </script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39377642-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
  <div id="wrapper">
  <div id="back-to-top"><a href="#top">↑ TOP</a></div>
    <div id="header" _height="auto">
      <div id="banner">
        <h1><a href="/home">掛川完熟酵母豚</a></h1>
        <ul>
          <li><a href="/about">關於榮騰</a></li>
          <li><a href="/technology">獨家技術</a></li>
          <li><a href="/product">產品介紹</a></li>
          <li><a href="/news">最新資訊</a></li>
          <li><a href="/link">友站連結</a></li>
          <li><a href="/orders">我要訂購</a></li>
        </ul>
      </div>
      <!--banner-->

      <div id="footer">
        <div id="social"> 
      <a target="_blank" href="http://www.facebook.com/sharer.php?s=100&p[url]=http://www.longtermyeast.com/&p[images][0]=http://www.longtermyeast.com/images/thumb.jpg&p[title]=%e5%9a%b4%e8%ac%b9%e7%9a%84%e6%a6%ae%e9%a8%b0%e8%be%b2%e7%94%a2%ef%bc%8c%e4%bb%a5%e5%89%b5%e6%96%b0%e6%8c%91%e6%88%b0%e7%be%8e%e5%91%b3%e7%9a%84%e6%a5%b5%e8%87%b4&p[summary]=%e5%a0%85%e6%8c%81%e6%8e%a1%e6%9c%80%e9%80%b2%e6%ad%a5%e7%9a%84%e9%a3%bc%e8%82%b2%e6%96%b9%e5%bc%8f%e5%8f%8a%e7%a7%91%e5%ad%b8%e5%8c%96%e7%ae%a1%e7%90%86%ef%bc%8c%e4%bb%a5%e5%a4%a9%e7%84%b6%e9%85%b5%e6%af%8d%e7%99%bc%e9%85%b5%e7%86%9f%e6%88%90%e7%9a%84%e5%84%aa%e8%b3%aa%e9%a3%bc%e6%96%99%ef%bc%8c%e9%a3%bc%e8%82%b2%e5%87%ba%e5%81%a5%e5%ba%b7%e3%80%81%e7%be%8e%e5%91%b3%e5%8f%88%e5%ae%89%e5%bf%83%e7%9a%84%e6%8e%9b%e5%b7%9d%e5%ae%8c%e7%86%9f%e9%85%b5%e6%af%8d%e8%b1%9a%ef%bc%8c%e4%b8%a6%e6%8c%81%e7%ba%8c%e7%a0%94%e7%99%bc%e5%89%b5%e6%96%b0%e6%9b%b4%e5%a4%9a%e9%a0%82%e7%b4%9a%e9%a3%9f%e6%9d%90%ef%bc%8c%e6%8c%91%e6%88%b0%e7%be%8e%e5%91%b3%e7%9a%84%e6%a5%b5%e8%87%b4%e3%80%82"><img src="/images/fb.png" width="38" height="38" /></a> 
      <a href="javascript: void(window.open('http://twitter.com/home/?status='.concat('榮騰農產以嚴謹態度持續研發創新，創造日本掛川酵母菌與豚肉的完美傑作──掛川完熟酵母豚，口感細緻層次豐富，是健康、美味又安心的頂級食材，讓您享受色、香、味俱全的感官旅程。') .concat(encodeURIComponent('網址'))));"><img src="/images/tw.png" width="38" height="38" /></a> 
      <a href="javascript:void(0)" onClick="javascript: void(window.open('http://www.plurk.com/?qualifier=shares&status=' .concat(encodeURIComponent('網址')) .concat(' ') .concat('(') .concat(encodeURIComponent('色、香、味俱全的感官旅程，盡在榮騰農產')) .concat(')')));"><img src="/images/pl.png" width="38" height="38" /></a></div>

        <div id="info"> <strong>榮騰農產股份有限公司</strong><br />
          <span>Long Term Yeast Co., Ltd.</span></strong><br />
          台北市衡陽路108號3樓之7<br />
        TEL：02-2382-0966<br />
        FAX：02-2382-0977
        </div>
      </div>
      <!--footer-->
    </div>
    <!--header-->

    
<%= form_for(@order) do |f| %>
<div id="container" _height="auto">
  <div id="top">
    <h2>產品介紹</h2>
  </div>
  <!--top-->

  <div id="content"  _height="auto">
    <div id="counter">
      <h3>您訂購的是：</h3>
      <img id="loading" src="/images/loading.png">
      <table id="productList" width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr id="freight">
          <td align="center">運費</td>
          <td>&nbsp;</td>
          <td align="center">&nbsp;</td>
          <td align="center">&nbsp;</td>
          <td>&nbsp;</td>
          <td align="right">NT :</td>
          <td align="right"><label id="showShippingfee"></label></td>
          <td align="center">元</td>
          <%= f.text_field :shippingfee, :autocomplete => "off", :style => "display: none;"  %>
        </tr>

        <tr id="total">
          <td colspan="8" align="right" valign="middle">金額總計：<a></a></td>
          <input id="orderitems" size="300" type="text" name="orderitems" style="display: none;"  />
          <%= f.text_field :totalprice, :autocomplete => "off", :style => "display: none;"  %>
        </tr>
      </table>

      <p> - 以上價格包含稅費及運費<br />
          - 運送說明：我們將交付冷凍物流公司，全程-18℃保存，將鮮甜味美的肉品為您宅配到府。<br />
          - 運費說明：凡購物滿2,000元以上可享免運費之優惠(單一送貨地址)，未達免運金額將酌收200元冷凍運送費，謝謝。<br />
          - 送貨日期：星期一至星期四下單將於隔天馬上為您出貨，星期五訂貨將於下個星期一出貨，如有特殊需求，<br />
          　　　　　　可填寫於備註欄，榮騰將竭力為您服務。 </p>
    </div>
    <!--counter-->

  <div class="article">
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td>備註欄：</td>
      </tr>
      <tr>
        <td><%= f.text_area :note, :autocomplete => "off" %></td>
      </tr>
    </table>
  </div>

    <div class="article">
      <h3>訂購人資料</h3>
      <table width="50%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td width="24%"><strong>*</strong>姓名： </td>
            <td colspan="2"><%= f.text_field :order_name, :autocomplete => "off", :class => "validate",:data => {:validate => "訂購人姓名"}  %></td>
          </tr>
          <tr>
            <td colspan="2"><strong>*</strong>連絡電話/手機： </td>
            <td width="59%"><%= f.text_field :order_phone, :autocomplete => "off", :class => "validate",:data => {:validate => "訂購人電話"}  %></td>
          </tr>
          <tr>
            <td>傳真： </td>
            <td colspan="2"><%= f.text_field :order_fax, :autocomplete => "off"%></td>
          </tr>
          <tr>
            <td>統一編號： </td>
            <td colspan="2"><%= f.text_field :order_companytaxID, :autocomplete => "off"%></td>
          </tr>
          <tr>
            <td><strong>*</strong>E-mail： </td>
            <td colspan="2"><%= f.text_field :order_email, :autocomplete => "off", :class => "validate",:data => {:validate => "訂購人E-mail"}  %></td>
          </tr>
        </table>
      </div>
      <div class="article">
        <h3>宅配取貨資料</h3>
        <table width="50%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="42%"><strong>*</strong>收貨人姓名：</td>
            <td width="58%"><%= f.text_field :receive_name, :autocomplete => "off", :class => "validate",:data => {:validate => "收貨人姓名"}  %></td>
          </tr>
          <tr>
            <td><strong>*</strong>收貨人電話/手機：</td>
            <td><%= f.text_field :receive_phone, :autocomplete => "off", :class => "validate",:data => {:validate => "收貨人電話"}  %></td>
          </tr>
          <tr>
            <td><strong>*</strong>指定收貨地址：</td>
            <td><%= f.text_field :receive_address, :autocomplete => "off", :class => "validate",:data => {:validate => "收貨人地址"}  %></td>
          </tr>
          <tr>
            <td><strong>*</strong>預定收貨日期：</td>
            <td><%= f.text_field :receive_date, :autocomplete => "off", :class => "validate",:data => {:validate => "預定收貨日期"}  %></td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>
              <input type="radio" name="preferred_time" value="morning" class="checkbox" /> 上午 <input type="radio" name="preferred_time" value="afternoon" class="checkbox" /> 下午
              <%= f.text_field :receive_time, :autocomplete => "off", :class => "validate", :style =>"display: none;",:data => {:validate => "預定收貨時間"} %></td>
          </tr>
        </table>
      </div>
      <div id="error" style="display:none;"></div>
      <div class="article" id="next">
      <h3>付款方式</h3>
      轉帳銀行：玉山銀行-城中分行<br />
      轉入帳號：0532-940-009885<br />
      戶名：榮騰農產股份有限公司<br />
      <a id="submit" href="#">確認</a>
      </div>
    </div>
    <!--content--> 
  </div>
  <!--container-->
<% end %>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $("#banner ul li").eq(5).addClass("select");

  
  <% @errormsg = "" %>
  <% @order.errors.full_messages.each do |msg| %>
  <% @errormsg+=msg%>;
  <% end %>
  console.log("<%= @errormsg %>");

  /* add datepicker */
  $( "#order_receive_date" ).datepicker();
  $( "#order_receive_date" ).change(function(){
    $(this).datepicker("option", "dateFormat", "yy-mm-dd");

    //compare the date
    if(new Date($(this).val()) <= new Date()){
      $(this).val("");
      $("#error").html("<p>預定收貨日期不能為過去的日期</p>").show();
    }
    else{
      $("#error").hide();
    }
  });

  $("#submit").click(function(event){
    if(formValidate()){
      $("form").submit();
      $("#submit").hide();
      $("#error").html("<p>訂單處理中, 請稍候</p>").show();
    }
    
    event.preventDefault();
  });

  $("input[type=radio]").change(function(){
    $("#order_receive_time").val($("input[type=radio]:checked").val());

  });

  /* validate the form before send */
  function formValidate(){
    var submit = true;
    var msg = "";

    $(".validate").each(function(){
      if(!$(this).val()){
        submit = false;
        msg += $(this).data("validate")+"不能為空<br />";
      }
    });

    //validate email value
    var emailrule = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
    if($("#order_order_email").val() && !$("#order_order_email").val().match(emailrule)){
      submit = false;

      msg += "請輸入正確的email<br />";
      $("#order_order_email").val("");
    }

    if(msg){
      $("#error").html(msg).show();
    }
    else{
      $("#error").hide();
    }
    return true;
    return submit;
  }

  /* show the orderitems and calculate the total price */
  
  var orderitems = '<%= @orderitems.to_json.html_safe %>';
  $("#orderitems").val(orderitems);
  $.ajax({
    type: "post",
    dataType: "json",
    data: {orderitems : orderitems},
    url: "/orders/calculate",
    success: function(data){
      var orderitems = JSON.parse(data.iteminfo);
      
      $.each(orderitems, function(index, item) {
        $("#freight").before('<tr>'+
        '<td width="25%" class="name">'+
        '<span>'+item.ordernum+'</span>'+item.name+'</td>'+
        '<td width="2%">│</td>'+
        '<td width="9%" align="center">'+item.weight+'</td>'+
        '<td width="10%" align="center">'+item.amount+'包</td>'+
        '<td width="2%">│</td>'+
        '<td width="33%" align="right">NT :</td>'+
        '<td width="15%" align="right">'+item.sum+' </td>'+
        '<td width="4%" align="center">元</td></tr>');
      });

      $("#loading").css("display", "none");


      //$("#order_totalprice").val(data.ordernum);
      $("#order_shippingfee").val(data.shippingfee);
      $("#showShippingfee").html(data.shippingfee);
      $("#total a").html(data.ordernum+data.shippingfee + " 元");
    }
  });


});
</script>

</div>
<!--wrapper-->
</body>
</html>