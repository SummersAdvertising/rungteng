<!DOCTYPE html>
<html style="background: #000;">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>榮騰農產</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= stylesheet_link_tag "order_check", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>

  <script>
  $(document).ready(function() {
    $("body").css("display", "none");
    $("body").fadeIn(500);
  });
  </script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39377642-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
  <div id="wrapper">
  <div id="back-to-top"><a href="#top">↑ TOP</a></div>
    <div id="header" _height="auto">
      <div id="banner">
        <h1><a href="/home">掛川完熟酵母豚</a></h1>
        <ul>
          <li><a href="/about">關於榮騰</a></li>
          <li><a href="/technology">獨家技術</a></li>
          <li><a href="/product">產品介紹</a></li>
          <li><a href="/news">最新資訊</a></li>
          <li><a href="/link">友站連結</a></li>
          <li><a href="http://www.appluco.com/itemlist.php?id=2532" target="_blank">我要訂購</a></li>
        </ul>
      </div>
      <!--banner-->

      <div id="footer">
        
      
      <div id="sn">累積來訪：<span><%= @count.count %></span></div><br>

        <div id="info"> <strong>榮騰農產股份有限公司</strong><br />
          <span>Long Term Yeast Co., Ltd.</span></strong><br />
          台北市衡陽路108號3樓之7<br />
        TEL：02-2382-0966<br />
        FAX：02-2382-0977
        </div>
      </div>
      <!--footer-->
    </div>
    <!--header-->

    
<%= form_for(@order) do |f| %>
<div id="container" _height="auto">
  <div id="top">
    <h2>產品介紹</h2>
  </div>
  <!--top-->

  <div id="content"  _height="auto">
    <div id="counter">
      <h3>您訂購的是：</h3>
      <img id="loading" src="/images/loading.png">
      <table id="productList" width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr id="freight">
          <td align="center">運費</td>
          <td>&nbsp;</td>
          <td align="center">&nbsp;</td>
          <td align="center">&nbsp;</td>
          <td>&nbsp;</td>
          <td align="right">NT :</td>
          <td align="right"><label id="showShippingfee"></label></td>
          <td align="center">元</td>
          <%= f.text_field :shippingfee, :autocomplete => "off", :style => "display: none;"  %>
        </tr>

        <tr id="total">
          <td colspan="8" align="right" valign="middle">金額總計：<a></a></td>
          <input id="orderitems" size="300" type="text" name="orderitems" style="display:none;" />
          <%= f.text_field :totalprice, :autocomplete => "off", :style => "display: none;"  %>
        </tr>
      </table>

      <p> - 以上價格包含稅費及運費<br />
          - 運送說明：我們將交付冷凍物流公司，全程-18℃保存，將鮮甜味美的肉品為您宅配到府。<br />
          - 運費說明：凡購物滿2,000元以上可享免運費之優惠(單一送貨地址)，未達免運金額將酌收200元冷凍運送費，謝謝。<br />
          - 送貨日期：星期一至星期四下單將於隔天馬上為您出貨，星期五訂貨將於下個星期一出貨，如有特殊需求，<br />
          　　　　　　可填寫於備註欄，榮騰將竭力為您服務。 </p>
    </div>
    <!--counter-->

  <div class="article">
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td>備註欄：</td>
      </tr>
      <tr>
        <td><%= f.text_area :note, :autocomplete => "off" %></td>
      </tr>
    </table>
  </div>

    <div class="article">
      <h3>訂購人資料</h3>
      <table width="50%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td width="24%"><strong>*</strong>姓名： </td>
            <td colspan="2"><%= f.text_field :order_name, :autocomplete => "off", :class => "validate",:data => {:validate => "訂購人姓名"}  %></td>
          </tr>
          <tr>
            <td colspan="2"><strong>*</strong>連絡電話/手機： </td>
            <td width="59%"><%= f.text_field :order_phone, :autocomplete => "off", :class => "validate",:data => {:validate => "訂購人電話"}  %></td>
          </tr>
          <tr>
            <td>傳真： </td>
            <td colspan="2"><%= f.text_field :order_fax, :autocomplete => "off"%></td>
          </tr>
          <tr>
            <td>統一編號： </td>
            <td colspan="2"><%= f.text_field :order_companytaxID, :autocomplete => "off"%></td>
          </tr>
          <tr>
            <td><strong>*</strong>E-mail： </td>
            <td colspan="2"><%= f.text_field :order_email, :autocomplete => "off", :class => "validate",:data => {:validate => "訂購人E-mail"}  %></td>
          </tr>
        </table>
      </div>
      <div class="article">
        <h3>宅配取貨資料</h3>
        <table width="50%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="42%"><strong>*</strong>收貨人姓名：</td>
            <td width="58%"><%= f.text_field :receive_name, :autocomplete => "off", :class => "validate",:data => {:validate => "收貨人姓名"}  %></td>
          </tr>
          <tr>
            <td><strong>*</strong>收貨人電話/手機：</td>
            <td><%= f.text_field :receive_phone, :autocomplete => "off", :class => "validate",:data => {:validate => "收貨人電話"}  %></td>
          </tr>
          <tr>
            <td><strong>*</strong>指定收貨地址：</td>
            <td><%= f.text_field :receive_address, :autocomplete => "off", :class => "validate",:data => {:validate => "收貨人地址"}  %></td>
          </tr>
          <tr>
            <td><strong>*</strong>預定收貨日期：</td>
            <td><%= f.text_field :receive_date, :autocomplete => "off", :class => "validate",:data => {:validate => "預定收貨日期"}  %></td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>
              <input type="radio" name="preferred_time" value="morning" class="checkbox" /> 上午 <input type="radio" name="preferred_time" value="afternoon" class="checkbox" /> 下午
              <%= f.text_field :receive_time, :autocomplete => "off", :class => "validate", :style =>"display: none;",:data => {:validate => "預定收貨時間"} %></td>
          </tr>
        </table>
      </div>
      <div id="error" style="display:none;"></div>
      <div class="article" id="next">
      <h3>付款方式</h3>
      轉帳銀行：玉山銀行-城中分行<br />
      轉入帳號：0532-940-009885<br />
      戶名：榮騰農產股份有限公司<br />
      <a id="submit" href="#">確認</a>
      </div>
    </div>
    <!--content--> 
  </div>
  <!--container-->
<% end %>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $("#banner ul li").eq(5).addClass("select");

  <% @errors = "" %>
  <% @order.errors.full_messages.each do |msg| %>
  <% @errors +=  msg + "<br><br>" %>
  <% end %>

  if("<%= @errors %>"){
    $("#error").html("<%= @errors %>".replace(/&lt;br&gt;/gi, "<br>")).show();
  }

  /* add datepicker */
  $( "#order_receive_date" ).datepicker();
  $( "#order_receive_date" ).change(function(){
    $(this).datepicker("option", "dateFormat", "yy-mm-dd");

    //compare the date
    if(new Date($(this).val()) <= new Date()){
      $(this).val("");
      $("#error").html("<p>預定收貨日期不能為過去的日期</p>").show();
    }
    else{
      $("#error").hide();
    }
  });

  $("#submit").click(function(event){
    $("form").submit();
    $("#submit").hide();
    $("#error").html("<p>訂單處理中, 請稍候</p>").show();
    event.preventDefault();
  });

  $("input[type=radio]").change(function(){
    $("#order_receive_time").val($("input[type=radio]:checked").val());
  });  
  
  var orderitems = '<%= @orderitems.to_json.html_safe %>';
  if(orderitems){
    /* show the orderitems and calculate the total price */
    $("#orderitems").val(orderitems);
    $.ajax({
      type: "post",
      dataType: "json",
      data: {orderitems : orderitems},
      url: "/orders/calculate",
      success: function(data){
        var orderitems = JSON.parse(data.iteminfo);

        $.each(orderitems, function(index, item) {
          $("#freight").before('<tr>'+
            '<td width="25%" class="name">'+
            '<span>'+item.ordernum+'</span>'+item.name+'</td>'+
            '<td width="2%">│</td>'+
            '<td width="9%" align="center">'+item.weight+'</td>'+
            '<td width="10%" align="center">'+item.amount+'包</td>'+
            '<td width="2%">│</td>'+
            '<td width="33%" align="right">NT :</td>'+
            '<td width="15%" align="right">'+item.sum+' </td>'+
            '<td width="4%" align="center">元</td></tr>');
        });

        $("#loading").css("display", "none");

        $("#order_totalprice").val(data.ordernum);
        $("#order_shippingfee").val(data.shippingfee);
        $("#showShippingfee").html(data.shippingfee);
        $("#total a").html(data.ordernum+data.shippingfee + " 元");
        
        
      }
    });
  }
  else{
    window.location = "/orders";
  }

});
</script>

</div>
<!--wrapper-->
</body>
</html>